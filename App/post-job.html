<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Post a Job - GigSafe Job Board</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --purple: #5B3A9D;
        --blue: #1d8bff;
        --violet: #6A4C9E;
        --indigo: #1f2b6c;
        --navy: #0f193b;
        --text-primary: #121826;
        --text-secondary: #4a5773;
        --surface: #ffffff;
        --surface-muted: #f5f7fd;
        --border: #dde3f5;
        --shadow-soft: 0 14px 30px rgba(20, 28, 58, 0.12);
        --shadow-card: 0 20px 45px rgba(52, 74, 165, 0.14);
        --radius-lg: 24px;
        --radius-md: 16px;
        --radius-pill: 999px;
        --max-width: 1120px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Manrope", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: var(--text-primary);
        background: var(--surface-muted);
        line-height: 1.6;
      }

      .page {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.85);
        border-bottom: 1px solid rgba(221, 227, 245, 0.6);
      }

      .nav {
        margin: 0 auto;
        max-width: var(--max-width);
        padding: 18px 4vw;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 24px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        color: var(--navy);
        font-size: 1.1rem;
        text-decoration: none;
      }

      .brand-mark {
        width: 42px;
        height: 42px;
        border-radius: 16px;
        display: grid;
        place-items: center;
        box-shadow: 0 16px 30px rgba(91, 58, 157, 0.35);
        overflow: hidden;
      }

      .brand-mark img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .nav-links {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .nav-links a {
        text-decoration: none;
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.95rem;
        transition: color 0.2s ease;
      }

      .nav-links a:hover {
        color: var(--blue);
      }

      .hero {
        background: linear-gradient(135deg, rgba(91, 58, 157, 0.95), rgba(106, 76, 158, 0.95));
        color: white;
        padding: 60px 4vw;
        text-align: center;
      }

      .hero-content {
        position: relative;
        margin: 0 auto;
        max-width: var(--max-width);
        display: grid;
        gap: 16px;
      }

      .hero-title {
        font-size: clamp(2rem, 4vw, 2.8rem);
        font-weight: 700;
        line-height: 1.1;
        margin: 0;
      }

      .hero-subtitle {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.85);
        margin: 0;
      }

      main {
        flex: 1;
        padding: 60px 4vw;
      }

      .form-container {
        margin: 0 auto;
        max-width: 800px;
        background: white;
        border-radius: var(--radius-lg);
        padding: 48px;
        box-shadow: var(--shadow-card);
      }

      .form-section {
        margin-bottom: 40px;
      }

      .form-section:last-child {
        margin-bottom: 0;
      }

      .form-section-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--navy);
        margin: 0 0 24px 0;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--border);
      }

      .form-group {
        margin-bottom: 24px;
      }

      .form-group:last-child {
        margin-bottom: 0;
      }

      .form-label {
        display: block;
        font-size: 0.9rem;
        font-weight: 700;
        color: var(--text-secondary);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .form-label.required::after {
        content: " *";
        color: #e74c3c;
      }

      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 14px 16px;
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-primary);
        background: #fafdff;
        font-family: inherit;
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }

      .form-textarea {
        min-height: 120px;
        resize: vertical;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: rgba(91, 58, 157, 0.9);
        box-shadow: 0 0 0 4px rgba(91, 58, 157, 0.15);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .form-hint {
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-top: 6px;
      }

      .form-actions {
        display: flex;
        gap: 16px;
        justify-content: flex-end;
        margin-top: 40px;
        padding-top: 32px;
        border-top: 1px solid var(--border);
      }

      .btn {
        border: none;
        border-radius: var(--radius-pill);
        padding: 14px 32px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        font-family: inherit;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--purple), var(--violet));
        color: white;
        box-shadow: 0 16px 30px rgba(91, 58, 157, 0.35);
      }

      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 18px 36px rgba(91, 58, 157, 0.4);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: var(--surface-muted);
        color: var(--text-secondary);
      }

      .btn-secondary:hover {
        background: var(--border);
      }

      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        z-index: 1000;
        animation: fadeIn 0.2s ease;
      }

      .modal-overlay.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-container {
        background: white;
        border-radius: var(--radius-lg);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        animation: slideUp 0.3s ease;
      }

      .modal-header {
        padding: 32px 32px 24px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--navy);
        margin: 0;
      }

      .modal-close {
        background: none;
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        cursor: pointer;
        color: var(--text-secondary);
        font-size: 1.5rem;
        line-height: 1;
        transition: background 0.2s ease, color 0.2s ease;
      }

      .modal-close:hover {
        background: var(--surface-muted);
        color: var(--text-primary);
      }

      .modal-body {
        padding: 32px;
      }

      .success-banner {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 20px 32px;
        text-align: center;
        font-weight: 700;
        font-size: 1.1rem;
      }

      .job-preview {
        background: white;
        border-radius: var(--radius-lg);
        padding: 24px;
        box-shadow: var(--shadow-soft);
        display: grid;
        gap: 16px;
      }

      .job-preview-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 16px;
      }

      .job-preview-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--navy);
        margin: 0;
        line-height: 1.3;
      }

      .job-preview-company {
        font-size: 1rem;
        color: var(--text-secondary);
        font-weight: 600;
        margin-top: 4px;
      }

      .job-preview-location {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 0.95rem;
        font-weight: 500;
      }

      .job-preview-pay {
        background: rgba(91, 58, 157, 0.1);
        color: var(--purple);
        padding: 8px 16px;
        border-radius: var(--radius-pill);
        font-weight: 700;
        font-size: 0.95rem;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .job-preview-description {
        color: var(--text-secondary);
        font-size: 0.95rem;
        line-height: 1.6;
      }

      .job-preview-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .job-tag {
        padding: 6px 12px;
        border-radius: var(--radius-pill);
        background: var(--surface-muted);
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.85rem;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .certifications-tags-container {
        background: rgba(255, 255, 255, 0.5);
        padding: 16px 20px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
      }

      .certifications-label {
        font-size: 0.85rem;
        font-weight: 700;
        color: var(--text-secondary);
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .certifications-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .cert-tag {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
        border-radius: var(--radius-pill);
        font-weight: 600;
        font-size: 0.9rem;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: default;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .cert-tag:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
      }

      .cert-tag-remove {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.15);
        color: rgba(0, 0, 0, 0.6);
        font-size: 14px;
        font-weight: 700;
        line-height: 1;
        cursor: pointer;
        transition: background 0.2s ease, color 0.2s ease;
      }

      .cert-tag-remove:hover {
        background: rgba(0, 0, 0, 0.25);
        color: rgba(0, 0, 0, 0.8);
      }

      @media (max-width: 768px) {
        .form-container {
          padding: 32px 24px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .form-actions {
          flex-direction: column-reverse;
        }

        .btn {
          width: 100%;
        }

        .modal-container {
          width: 95%;
          max-height: 95vh;
        }

        .modal-header,
        .modal-body {
          padding: 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <nav class="nav">
          <a href="/" class="brand">
            <div class="brand-mark">
              <img src="/attached_assets/GigSafe_Logo_1762548362018.png" alt="GigSafe Logo" />
            </div>
            <span>GigSafe Job Board</span>
          </a>
          <div class="nav-links">
            <a href="/">Browse Jobs</a>
            <a href="/post-job.html">Post a Job</a>
          </div>
        </nav>
      </header>

      <div class="hero">
        <div class="hero-content">
          <h1 class="hero-title">Post a Job</h1>
          <p class="hero-subtitle">
            Share your delivery driver or logistics opportunity with qualified candidates
          </p>
        </div>
      </div>

      <main>
        <div class="form-container">
          <form id="jobForm">
            <div class="form-section">
              <h2 class="form-section-title">Job Details</h2>
              
              <div class="form-group">
                <label class="form-label required" for="title">Job Title</label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  class="form-input"
                  placeholder="e.g., Delivery Driver, Box Truck Driver"
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label required" for="company">Company Name</label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  class="form-input"
                  placeholder="Your company name"
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label required" for="job_url">Application URL</label>
                <input
                  type="url"
                  id="job_url"
                  name="job_url"
                  class="form-input"
                  placeholder="https://example.com/apply"
                  required
                />
                <div class="form-hint">Where candidates can apply for this position</div>
              </div>
            </div>

            <div class="form-section">
              <h2 class="form-section-title">Location</h2>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label required" for="city">City</label>
                  <input
                    type="text"
                    id="city"
                    name="city"
                    class="form-input"
                    placeholder="e.g., Seattle"
                    required
                  />
                </div>

                <div class="form-group">
                  <label class="form-label required" for="state">State</label>
                  <select
                    id="state"
                    name="state"
                    class="form-select"
                    required
                  >
                    <option value="">Select State</option>
                    <option>AL</option>
                    <option>AK</option>
                    <option>AZ</option>
                    <option>AR</option>
                    <option>CA</option>
                    <option>CO</option>
                    <option>CT</option>
                    <option>DE</option>
                    <option>FL</option>
                    <option>GA</option>
                    <option>HI</option>
                    <option>ID</option>
                    <option>IL</option>
                    <option>IN</option>
                    <option>IA</option>
                    <option>KS</option>
                    <option>KY</option>
                    <option>LA</option>
                    <option>ME</option>
                    <option>MD</option>
                    <option>MA</option>
                    <option>MI</option>
                    <option>MN</option>
                    <option>MS</option>
                    <option>MO</option>
                    <option>MT</option>
                    <option>NE</option>
                    <option>NV</option>
                    <option>NH</option>
                    <option>NJ</option>
                    <option>NM</option>
                    <option>NY</option>
                    <option>NC</option>
                    <option>ND</option>
                    <option>OH</option>
                    <option>OK</option>
                    <option>OR</option>
                    <option>PA</option>
                    <option>RI</option>
                    <option>SC</option>
                    <option>SD</option>
                    <option>TN</option>
                    <option>TX</option>
                    <option>UT</option>
                    <option>VT</option>
                    <option>VA</option>
                    <option>WA</option>
                    <option>WV</option>
                    <option>WI</option>
                    <option>WY</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="address">Full Address (Optional)</label>
                <input
                  type="text"
                  id="address"
                  name="address"
                  class="form-input"
                  placeholder="Street address"
                />
              </div>
            </div>

            <div class="form-section">
              <h2 class="form-section-title">Description</h2>
              
              <div class="form-group">
                <label class="form-label required" for="description">Description</label>
                <textarea
                  id="description"
                  name="description"
                  class="form-textarea"
                  placeholder="Describe the job, responsibilities, and what makes it great..."
                  required
                ></textarea>
              </div>

              <div class="form-group">
                <label class="form-label" for="certifications_select">Certifications</label>
                <select class="form-select" id="certifications_select">
                  <option value="">Select a certification</option>
                  <option value="HIPPA">HIPPA</option>
                  <option value="BPP">BPP</option>
                  <option value="STA">STA</option>
                  <option value="TSA">TSA</option>
                  <option value="TWIC">TWIC</option>
                  <option value="CDA">CDA</option>
                  <option value="NSA">NSA</option>
                  <option value="CIA">CIA</option>
                  <option value="FBI">FBI</option>
                  <option value="PBS">PBS</option>
                </select>
                <div class="certifications-tags-container" id="certificationsContainer" style="margin-top: 16px; display: none">
                  <div class="certifications-label">Selected Certifications:</div>
                  <div class="certifications-tags" id="certificationsTags"></div>
                </div>
                <input type="hidden" id="general_requirements" name="general_requirements" />
              </div>

              <div class="form-group">
                <label class="form-label" for="vehicle_requirements">Vehicle Requirements</label>
                <input
                  type="text"
                  id="vehicle_requirements"
                  name="vehicle_requirements"
                  class="form-input"
                  placeholder="e.g., Van, Box Truck, Car, Personal Vehicle"
                />
              </div>

              <div class="form-group">
                <label class="form-label" for="insurance_requirement">Insurance Requirements</label>
                <input
                  type="text"
                  id="insurance_requirement"
                  name="insurance_requirement"
                  class="form-input"
                  placeholder="e.g., Commercial insurance required, Company provides insurance"
                />
              </div>

              <div class="form-group">
                <label class="form-label" for="certifications_required">Certifications Required</label>
                <input
                  type="text"
                  id="certifications_required"
                  name="certifications_required"
                  class="form-input"
                  placeholder="e.g., HIPAA, BPP, TWIC, TSA, STA, HAZMAT (comma-separated)"
                />
              </div>

              <div class="form-group">
                <label class="form-label" for="schedule_details">Schedule Details</label>
                <input
                  type="text"
                  id="schedule_details"
                  name="schedule_details"
                  class="form-input"
                  placeholder="Work hours, shifts, flexibility..."
                />
              </div>
            </div>

            <div class="form-section">
              <h2 class="form-section-title">Compensation & Benefits</h2>
              
              <div class="form-group">
                <label class="form-label required" for="pay">Pay</label>
                <input
                  type="text"
                  id="pay"
                  name="pay"
                  class="form-input"
                  placeholder="e.g., $18-22/hour, $150-180/day"
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label" for="benefits">Benefits</label>
                <textarea
                  id="benefits"
                  name="benefits"
                  class="form-textarea"
                  placeholder="Health insurance, paid time off, bonuses, etc..."
                ></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="window.location.href='/'">
                Cancel
              </button>
              <button type="submit" class="btn btn-primary" id="submitBtn">
                Post Job
              </button>
            </div>
          </form>
        </div>
      </main>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
      <div class="modal-container">
        <div class="success-banner">
          ‚úì Job Posted Successfully!
        </div>
        <div class="modal-header">
          <h2 class="modal-title">Your Job is Now Live</h2>
          <button class="modal-close" onclick="closeSuccessModal()">√ó</button>
        </div>
        <div class="modal-body">
          <div class="job-preview" id="jobPreview">
            <!-- Job preview will be inserted here -->
          </div>
          <div style="margin-top: 24px; text-align: center;">
            <button class="btn btn-primary" onclick="window.location.href='/'">
              View All Jobs
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById('jobForm');
      const submitBtn = document.getElementById('submitBtn');
      const successModal = document.getElementById('successModal');
      const jobPreview = document.getElementById('jobPreview');
      const certificationsSelect = document.getElementById('certifications_select');
      const certificationsContainer = document.getElementById('certificationsContainer');
      const certificationsTags = document.getElementById('certificationsTags');
      const generalRequirementsInput = document.getElementById('general_requirements');

      const selectedCertifications = [];
      const pastelColors = [
        "#FFE5E5",
        "#E5F3FF",
        "#E5FFE5",
        "#FFE5FF",
        "#FFF5E5",
        "#FFFFE5",
        "#E5FFFF",
        "#F5E5FF",
        "#FFE5EC",
        "#E5FFF5",
      ];
      let colorIndex = 0;

      function addCertification(cert) {
        if (!cert || selectedCertifications.includes(cert)) {
          return;
        }

        selectedCertifications.push(cert);

        const tag = document.createElement("div");
        tag.className = "cert-tag";
        tag.dataset.cert = cert;

        const color = pastelColors[colorIndex % pastelColors.length];
        colorIndex++;
        tag.style.backgroundColor = color;
        tag.style.color = "#333";

        tag.innerHTML = `
          <span>${cert}</span>
          <span class="cert-tag-remove">&times;</span>
        `;

        tag.querySelector(".cert-tag-remove").addEventListener("click", (e) => {
          e.stopPropagation();
          removeCertification(cert);
        });

        certificationsTags.appendChild(tag);

        if (certificationsContainer) {
          certificationsContainer.style.display = "block";
        }

        const option = certificationsSelect.querySelector(`option[value="${cert}"]`);
        if (option) {
          option.disabled = true;
          option.style.display = "none";
        }

        certificationsSelect.value = "";
        updateHiddenField();
      }

      function removeCertification(cert) {
        const index = selectedCertifications.indexOf(cert);
        if (index > -1) {
          selectedCertifications.splice(index, 1);
        }

        const tag = certificationsTags.querySelector(`[data-cert="${cert}"]`);
        if (tag) {
          tag.remove();
        }

        const option = certificationsSelect.querySelector(`option[value="${cert}"]`);
        if (option) {
          option.disabled = false;
          option.style.display = "";
        }

        if (selectedCertifications.length === 0 && certificationsContainer) {
          certificationsContainer.style.display = "none";
        }

        updateHiddenField();
      }

      function updateHiddenField() {
        generalRequirementsInput.value = selectedCertifications.join(', ');
      }

      if (certificationsSelect) {
        certificationsSelect.addEventListener("change", (e) => {
          const cert = e.target.value;
          if (cert) {
            addCertification(cert);
          }
        });
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        submitBtn.disabled = true;
        submitBtn.textContent = 'Posting...';

        const formData = new FormData(form);
        const jobData = Object.fromEntries(formData.entries());

        try {
          const response = await fetch('/api/jobs', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(jobData),
          });

          const result = await response.json();

          if (response.ok && result.success) {
            showSuccessModal(result.data);
          } else {
            alert(result.error || 'Failed to post job. Please try again.');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Post Job';
          }
        } catch (error) {
          console.error('Error posting job:', error);
          alert('An error occurred. Please try again.');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Post Job';
        }
      });

      function showSuccessModal(job) {
        const location = [job.city, job.state].filter(Boolean).join(', ') || 'Location not specified';
        
        jobPreview.innerHTML = `
          <div class="job-preview-header">
            <div>
              <h3 class="job-preview-title">${escapeHtml(job.title)}</h3>
              <div class="job-preview-company">${escapeHtml(job.company)}</div>
              <div class="job-preview-location">üìç ${escapeHtml(location)}</div>
            </div>
            ${job.pay ? `<div class="job-preview-pay">${escapeHtml(job.pay)}</div>` : ''}
          </div>
          ${job.description ? `<div class="job-preview-description">${escapeHtml(job.description)}</div>` : ''}
          <div class="job-preview-tags">
            ${job.vehicle_requirements ? `<span class="job-tag">${escapeHtml(job.vehicle_requirements)}</span>` : ''}
            ${job.insurance_requirement ? `<span class="job-tag">${escapeHtml(job.insurance_requirement)}</span>` : ''}
          </div>
        `;
        
        successModal.classList.add('active');
      }

      function closeSuccessModal() {
        successModal.classList.remove('active');
        window.location.href = '/';
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // Close modal on overlay click
      successModal.addEventListener('click', (e) => {
        if (e.target === successModal) {
          closeSuccessModal();
        }
      });
    </script>
  </body>
</html>
