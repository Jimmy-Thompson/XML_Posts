<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GigSafe Job Board</title>

    <!-- Posthog Analytics -->
    <script>
      !(function (t, e) {
        var o, n, p, r;
        e.__SV ||
          ((window.posthog = e),
          (e._i = []),
          (e.init = function (i, s, a) {
            function g(t, e) {
              var o = e.split(".");
              2 == o.length && ((t = t[o[0]]), (e = o[1])),
                (t[e] = function () {
                  t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
                });
            }
            ((p = t.createElement("script")).type = "text/javascript"),
              (p.async = !0),
              (p.src = s.api_host + "/static/array.js"),
              (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(
                p,
                r,
              );
            var u = e;
            for (
              void 0 !== a ? (u = e[a] = []) : (a = "posthog"),
                u.people = u.people || [],
                u.toString = function (t) {
                  var e = "posthog";
                  return (
                    "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e
                  );
                },
                u.people.toString = function () {
                  return u.toString(1) + ".people (stub)";
                },
                o =
                  "capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys getNextSurveyStep".split(
                    " ",
                  ),
                n = 0;
              n < o.length;
              n++
            )
              g(u, o[n]);
            e._i.push([i, s, a]);
          }),
          (e.__SV = 1));
      })(document, window.posthog || []);

      // Initialize Posthog with your project API key
      posthog.init("phc_YecmI0SDdgR8klBr7HK8Xu7WvlrPaHxznJRlTZI8wXZ", {
        api_host: "https://us.i.posthog.com",
        person_profiles: "identified_only", // For privacy - only track identified users
        autocapture: true, // Automatically capture clicks
        session_recording: {
          enabled: true, // Enable session replay
          recordCrossOriginIframes: false,
        },
        capture_pageview: true, // Automatically capture page views
        capture_pageleave: true, // Track when users leave
      });
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --purple: #4B238C;
        --black: #000000;
        --violet: #5B3A9D;
        --indigo: #1f2b6c;
        --navy: #0f193b;
        --text-primary: #121826;
        --text-secondary: #4a5773;
        --surface: #ffffff;
        --surface-muted: #f5f7fd;
        --border: #dde3f5;
        --shadow-soft: 0 14px 30px rgba(20, 28, 58, 0.12);
        --shadow-card: 0 20px 45px rgba(52, 74, 165, 0.14);
        --radius-lg: 24px;
        --radius-md: 16px;
        --radius-pill: 999px;
        --max-width: 1120px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Manrope", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        color: var(--text-primary);
        background: var(--surface-muted);
        line-height: 1.6;
      }

      .page {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.85);
        border-bottom: 1px solid rgba(221, 227, 245, 0.6);
      }

      .nav {
        margin: 0 auto;
        max-width: var(--max-width);
        padding: 18px 4vw;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 24px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        color: var(--navy);
        font-size: 1.1rem;
      }

      .brand-mark {
        width: 42px;
        height: 42px;
        border-radius: 16px;
        display: grid;
        place-items: center;
        box-shadow: 0 16px 30px rgba(91, 58, 157, 0.35);
        overflow: hidden;
      }

      .brand-mark img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .nav-links {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .nav-links a {
        text-decoration: none;
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.95rem;
        transition: color 0.2s ease;
      }

      .nav-links a:hover {
        color: var(--blue);
      }

      .hero {
        background: radial-gradient(circle at top left, rgba(75, 35, 140, 0.4), transparent 55%),
          linear-gradient(135deg, rgba(75, 35, 140, 0.98) 0%, rgba(75, 35, 140, 0.98) 75%, rgba(0, 0, 0, 0.95) 100%);
        color: white;
        padding: 60px 4vw 96px;
        position: relative;
        overflow: hidden;
      }

      .hero::after {
        content: "";
        position: absolute;
        inset: 0;
        opacity: 0.15;
        background: url("data:image/svg+xml,%3Csvg width='400' height='400' viewBox='0 0 400 400' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='200' cy='200' r='180' stroke='white' stroke-opacity='0.2' stroke-width='2'/%3E%3Ccircle cx='200' cy='200' r='120' stroke='white' stroke-opacity='0.12' stroke-width='2'/%3E%3C/svg%3E")
          center/cover no-repeat;
        pointer-events: none;
      }

      .hero-content {
        position: relative;
        margin: 0 auto;
        max-width: var(--max-width);
        display: grid;
        gap: 28px;
      }

      .hero-eyebrow {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.16);
        color: rgba(255, 255, 255, 0.85);
        padding: 8px 18px;
        border-radius: var(--radius-pill);
        font-weight: 600;
        font-size: 0.9rem;
        backdrop-filter: blur(12px);
      }

      .hero-title {
        font-size: clamp(2.7rem, 5vw, 3.8rem);
        font-weight: 700;
        line-height: 1.08;
        max-width: 680px;
        margin: 0;
      }

      .hero-subtitle {
        font-size: 1.1rem;
        max-width: 580px;
        color: rgba(255, 255, 255, 0.82);
        margin: 0;
      }

      .search-card {
        background: white;
        color: var(--text-primary);
        padding: 28px;
        border-radius: var(--radius-lg);
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: flex-end;
        box-shadow: var(--shadow-card);
      }

      .search-group {
        display: grid;
        gap: 6px;
        flex: 1 1 180px;
        min-width: 0;
      }

      .search-label {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 700;
        color: var(--text-secondary);
      }

      .search-input,
      .search-select {
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 14px 16px;
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-primary);
        background: #fafdff;
        transition: border 0.2s ease, box-shadow 0.2s ease;
        width: 100%;
      }

      .search-input:focus,
      .search-select:focus {
        outline: none;
        border-color: rgba(91, 58, 157, 0.9);
        box-shadow: 0 0 0 4px rgba(91, 58, 157, 0.15);
      }

      .search-actions {
        display: flex;
        gap: 16px;
        justify-content: flex-end;
        align-items: center;
        flex: 1 1 180px;
        min-width: 180px;
      }

      .remote-toggle {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: rgba(91, 58, 157, 0.12);
        color: var(--purple);
        padding: 10px 16px;
        border-radius: var(--radius-pill);
        font-weight: 600;
      }

      .search-button {
        border: none;
        border-radius: var(--radius-pill);
        padding: 14px 30px;
        font-size: 1rem;
        font-weight: 700;
        color: white;
        background: var(--purple);
        cursor: pointer;
        box-shadow: 0 16px 30px rgba(75, 35, 140, 0.4);
        transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
      }

      .search-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 18px 36px rgba(75, 35, 140, 0.5);
        filter: brightness(1.05);
      }

      .trust-bar {
        background: white;
        padding: 32px 4vw;
        border-bottom: 1px solid var(--border);
      }

      .trust-inner {
        margin: 0 auto;
        max-width: var(--max-width);
        display: flex;
        flex-wrap: wrap;
        gap: 24px;
        align-items: center;
        justify-content: space-between;
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.95rem;
      }

      .logo-row {
        display: flex;
        gap: 28px;
        align-items: center;
        flex-wrap: wrap;
      }

      .logo-chip {
        padding: 10px 20px;
        border-radius: var(--radius-pill);
        background: var(--surface-muted);
        color: var(--text-secondary);
        font-weight: 600;
        letter-spacing: 0.02em;
      }

      main {
        flex: 1;
      }

      section {
        padding: 80px 4vw;
      }

      .section-inner {
        margin: 0 auto;
        max-width: var(--max-width);
        display: grid;
        gap: 40px;
      }

      .section-header {
        display: flex;
        flex-direction: column;
        gap: 12px;
        max-width: 640px;
      }

      .section-eyebrow {
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-weight: 700;
        color: var(--text-secondary);
        font-size: 0.8rem;
      }

      .section-title {
        font-size: clamp(1.9rem, 3vw, 2.4rem);
        font-weight: 700;
        margin: 0;
        color: var(--navy);
      }

      .section-description {
        margin: 0;
        color: var(--text-secondary);
      }

      .card-grid {
        display: grid;
        gap: 24px;
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .job-card {
        padding: 24px;
        border-radius: var(--radius-lg);
        background: white;
        box-shadow: var(--shadow-soft);
        display: grid;
        gap: 20px;
      }

      .job-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--text-secondary);
        font-size: 0.85rem;
        font-weight: 600;
      }

      .job-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--navy);
        margin: 0;
      }

      .tag-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .tag {
        padding: 8px 14px;
        border-radius: var(--radius-pill);
        background: rgba(91, 58, 157, 0.12);
        color: var(--purple);
        font-weight: 600;
        font-size: 0.85rem;
      }

      .link-cta {
        justify-self: flex-start;
        text-decoration: none;
        font-weight: 700;
        color: var(--blue);
      }

      .features {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .feature-card {
        background: white;
        border-radius: var(--radius-lg);
        padding: 28px;
        box-shadow: var(--shadow-soft);
        display: grid;
        gap: 16px;
      }

      .feature-icon {
        width: 52px;
        height: 52px;
        border-radius: 18px;
        background: linear-gradient(140deg, rgba(91, 58, 157, 0.16), rgba(106, 76, 158, 0.16));
        display: grid;
        place-items: center;
        color: var(--purple);
        font-weight: 700;
        font-size: 1.4rem;
      }

      .feature-title {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--navy);
      }

      .feature-copy {
        margin: 0;
        color: var(--text-secondary);
      }

      .testimonials {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .testimonial-card {
        background: white;
        border-radius: var(--radius-lg);
        padding: 32px;
        box-shadow: var(--shadow-soft);
        display: grid;
        gap: 22px;
        position: relative;
      }

      .testimonial-card::before {
        content: '"';
        position: absolute;
        top: 18px;
        right: 28px;
        font-size: 4rem;
        color: rgba(91, 58, 157, 0.18);
        line-height: 1;
      }

      .testimonial-quote {
        margin: 0;
        font-size: 1.05rem;
        color: var(--navy);
        font-weight: 600;
      }

      .testimonial-author {
        display: flex;
        align-items: center;
        gap: 14px;
      }

      .avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(140deg, rgba(91, 58, 157, 0.3), rgba(106, 76, 158, 0.3));
        display: grid;
        place-items: center;
        color: white;
        font-weight: 700;
      }

      .author-name {
        font-weight: 700;
        color: var(--navy);
      }

      .author-role {
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .insights-grid {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .insight-card {
        background: white;
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-soft);
        display: grid;
        grid-template-rows: 160px auto;
      }

      .insight-visual {
        background: linear-gradient(135deg, rgba(91, 58, 157, 0.75), rgba(106, 76, 158, 0.75));
        position: relative;
      }

      .insight-visual::after {
        content: "";
        position: absolute;
        inset: 20px;
        border: 1px solid rgba(255, 255, 255, 0.45);
        border-radius: var(--radius-lg);
        opacity: 0.9;
      }

      .insight-body {
        padding: 24px;
        display: grid;
        gap: 16px;
      }

      .insight-title {
        font-size: 1.05rem;
        font-weight: 700;
        margin: 0;
        color: var(--navy);
      }

      .insight-copy {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.95rem;
      }

      .cta-band {
        background: linear-gradient(135deg, var(--purple) 0%, var(--purple) 75%, var(--black) 100%);
        color: white;
        padding: 72px 4vw;
        position: relative;
        overflow: hidden;
      }

      .cta-inner {
        margin: 0 auto;
        max-width: var(--max-width);
        display: grid;
        gap: 26px;
        text-align: center;
        position: relative;
      }

      .cta-title {
        font-size: clamp(2.2rem, 5vw, 2.8rem);
        margin: 0;
        font-weight: 700;
      }

      .cta-copy {
        margin: 0;
        color: rgba(255, 255, 255, 0.82);
      }

      .cta-actions {
        display: flex;
        justify-content: center;
        gap: 18px;
        flex-wrap: wrap;
      }

      .primary-cta,
      .secondary-cta {
        border: none;
        border-radius: var(--radius-pill);
        font-weight: 700;
        padding: 14px 30px;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, color 0.2s ease, background 0.2s ease;
      }

      .primary-cta {
        background: white;
        color: var(--purple);
        box-shadow: 0 18px 40px rgba(91, 58, 157, 0.35);
      }

      .primary-cta:hover {
        transform: translateY(-2px);
      }

      .secondary-cta {
        background: rgba(255, 255, 255, 0.18);
        color: white;
      }

      .secondary-cta:hover {
        background: rgba(255, 255, 255, 0.24);
      }

      footer {
        background: var(--navy);
        color: rgba(255, 255, 255, 0.82);
        padding: 40px 4vw;
      }

      .footer-inner {
        margin: 0 auto;
        max-width: var(--max-width);
        display: grid;
        gap: 28px;
      }

      .footer-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 40px;
        flex-wrap: wrap;
      }

      .footer-brand {
        max-width: 320px;
      }

      .footer-brand p {
        margin: 12px 0 0;
        color: rgba(255, 255, 255, 0.66);
      }

      .footer-links {
        display: flex;
        gap: 28px;
        flex-wrap: wrap;
      }

      .footer-links a {
        text-decoration: none;
        color: rgba(255, 255, 255, 0.72);
        font-weight: 600;
      }

      .footer-bottom {
        border-top: 1px solid rgba(255, 255, 255, 0.12);
        padding-top: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 16px;
        font-size: 0.85rem;
      }

      .social {
        display: flex;
        gap: 14px;
      }

      .social a {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.12);
        display: grid;
        place-items: center;
        color: white;
        text-decoration: none;
        font-weight: 700;
      }

      @media (min-width: 769px) and (max-width: 1024px) {
        .search-group,
        .search-actions {
          flex: 1 1 calc(50% - 8px);
        }

        .card-grid,
        .features,
        .insights-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      @media (max-width: 768px) {
        header {
          position: static;
        }

        .nav {
          flex-wrap: nowrap;
          gap: 12px;
        }

        .brand {
          flex-shrink: 0;
        }

        .nav-links {
          flex: 1;
          justify-content: flex-end;
          gap: 12px;
          min-width: 0;
        }

        .nav-links a {
          font-size: 0.85rem;
          white-space: nowrap;
        }

        .hero {
          padding: 40px 6vw 40px !important;
        }

        .search-card {
          padding: 20px;
          gap: 12px;
          display: grid;
          grid-template-columns: 1fr 1fr;
        }

        .search-group {
          flex: auto;
        }

        .search-group:first-child {
          grid-column: 1 / -1;
        }

        .search-label {
          font-size: 0.75rem;
        }

        .search-input {
          padding: 10px 14px;
        }

        .search-select {
          padding: 10px 14px;
        }

        .search-actions {
          grid-column: 1 / -1;
          justify-content: stretch;
        }

        .search-button {
          width: 100%;
          padding: 12px 24px;
        }

        .subscribe-button {
          padding: 10px;
          width: 44px;
          height: 44px;
          justify-content: center;
        }

        .subscribe-text {
          display: none;
        }

        .bell-icon {
          width: 22px;
          height: 22px;
        }

        .card-grid,
        .features,
        .testimonials,
        .insights-grid {
          grid-template-columns: minmax(0, 1fr);
        }

        section {
          padding: 64px 6vw;
        }

        .section-header {
          text-align: left;
        }
      }

      @media (max-width: 480px) {
        .brand {
          font-size: 1rem;
        }

        .hero-title {
          font-size: 2.2rem;
        }

        .hero-subtitle {
          font-size: 1rem;
        }

        .logo-row {
          gap: 14px;
        }

        .logo-chip {
          padding: 8px 14px;
          font-size: 0.85rem;
        }

        .cta-actions {
          width: 100%;
        }

        .primary-cta,
        .secondary-cta {
          width: 100%;
        }

        .footer-top {
          flex-direction: column;
          gap: 24px;
        }

        .footer-bottom {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      /* Certifications tags */
      .certifications-tags-container {
        background: rgba(255, 255, 255, 0.5);
        padding: 16px 20px;
        border-radius: var(--radius-md);
        margin-top: 16px;
      }

      .certifications-label {
        font-size: 0.85rem;
        font-weight: 700;
        color: var(--text-secondary);
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .certifications-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .cert-tag {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
        border-radius: var(--radius-pill);
        font-weight: 600;
        font-size: 0.9rem;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: default;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      .cert-tag:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
      }

      .cert-tag-remove {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.15);
        color: rgba(0, 0, 0, 0.6);
        font-size: 14px;
        font-weight: 700;
        line-height: 1;
        cursor: pointer;
        transition: background 0.2s ease, color 0.2s ease;
      }

      .cert-tag-remove:hover {
        background: rgba(0, 0, 0, 0.25);
        color: rgba(0, 0, 0, 0.8);
      }

      /* Jobs listing section */
      .jobs-section {
        padding: 60px 4vw;
        background: var(--surface-muted);
      }

      .jobs-container {
        margin: 0 auto;
        max-width: var(--max-width);
      }

      .jobs-scroll-area {
        max-height: 70vh;
        overflow-y: auto;
        display: grid;
        gap: 20px;
        padding-right: 8px;
        padding-left: 8px;
      }

      .jobs-scroll-area::-webkit-scrollbar {
        width: 8px;
      }

      .jobs-scroll-area::-webkit-scrollbar-thumb {
        background: rgba(74, 87, 115, 0.25);
        border-radius: 999px;
      }

      .jobs-scroll-area::-webkit-scrollbar-track {
        background: rgba(221, 227, 245, 0.4);
        border-radius: 999px;
      }

      .jobs-header {
        margin-bottom: 32px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .jobs-count {
        font-size: 1.1rem;
        color: var(--text-secondary);
        font-weight: 600;
      }

      .jobs-grid {
        display: grid;
        gap: 20px;
        grid-template-columns: minmax(0, 1fr);
      }

      .jobs-sentinel {
        height: 1px;
      }

      .job-item {
        background: white;
        border-radius: var(--radius-lg);
        padding: 24px;
        box-shadow: var(--shadow-soft);
        display: grid;
        gap: 16px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .job-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-card);
      }

      /* Gold corner sash for user-submitted jobs */
      .job-item[data-user-submitted="true"]::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 30px 30px 0 0;
        border-color: #E5C158 transparent transparent transparent;
        z-index: 1;
      }

      .job-item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 16px;
      }

      .job-item-title {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--navy);
        margin: 0;
        line-height: 1.3;
      }

      .job-item-company {
        font-size: 1rem;
        color: var(--text-secondary);
        font-weight: 600;
        margin-top: 4px;
      }

      .job-item-location {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 0.95rem;
        font-weight: 500;
      }

      .job-item-pay {
        background: rgba(91, 58, 157, 0.1);
        color: var(--purple);
        padding: 8px 16px;
        border-radius: var(--radius-pill);
        font-weight: 700;
        font-size: 0.95rem;
        white-space: nowrap;
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        flex-shrink: 0;
      }

      .job-item-description {
        color: var(--text-secondary);
        font-size: 0.95rem;
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .job-item-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .job-tag {
        padding: 6px 12px;
        border-radius: var(--radius-pill);
        background: var(--surface-muted);
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.85rem;
      }

      .jobs-empty,
      .jobs-error {
        text-align: center;
        padding: 40px;
        font-weight: 600;
      }

      .jobs-empty {
        color: var(--text-secondary);
      }

      .jobs-error {
        color: #c0392b;
      }

      .loading-spinner {
        text-align: center;
        padding: 40px;
        color: var(--text-secondary);
        font-weight: 600;
      }

      .loading-spinner::after {
        content: "Loading more jobs...";
      }

      .no-more-jobs {
        text-align: center;
        padding: 40px;
        color: var(--text-secondary);
        font-weight: 600;
      }

      @media (max-width: 768px) {
        .jobs-section .section-title {
          display: none;
        }

        .jobs-section {
          padding: 32px 4vw;
        }

        .jobs-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 16px;
          margin-bottom: 24px;
        }

        .job-item-header {
          flex-direction: column;
        }

        .job-item-pay {
          align-self: flex-start;
        }

        .jobs-scroll-area {
          max-height: none;
          padding-right: 0;
        }
      }

      /* Subscribe button and modal */
      .subscribe-button {
        border: none;
        border-radius: var(--radius-pill);
        padding: 12px 24px;
        font-size: 0.95rem;
        font-weight: 700;
        color: white;
        background: var(--purple);
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(75, 35, 140, 0.35);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .bell-icon {
        flex-shrink: 0;
      }

      .subscribe-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(75, 35, 140, 0.5);
      }

      .subscribe-button.subscribed {
        background: linear-gradient(135deg, #10b981, #059669);
        cursor: not-allowed;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      .subscribe-button.subscribed:hover {
        transform: none;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        z-index: 1000;
        animation: fadeIn 0.2s ease;
      }

      .modal-overlay.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-container {
        background: white;
        border-radius: var(--radius-lg);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        animation: slideUp 0.3s ease;
      }

      .modal-header {
        padding: 32px 32px 24px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--navy);
        margin: 0;
      }

      .modal-close {
        background: none;
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        cursor: pointer;
        color: var(--text-secondary);
        font-size: 1.5rem;
        line-height: 1;
        transition: background 0.2s ease, color 0.2s ease;
      }

      .modal-close:hover {
        background: var(--surface-muted);
        color: var(--text-primary);
      }

      .modal-body {
        padding: 32px;
        min-height: 200px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 768px) {
        .modal-container {
          width: 90%;
          max-width: 400px;
          max-height: 85vh;
          margin: 20px auto;
        }

        .modal-header {
          padding: 20px 20px 16px;
        }

        .modal-title {
          font-size: 1.5rem;
        }

        .modal-body {
          padding: 20px;
          padding-bottom: 24px;
        }
      }

      /* Subscribe form styles */
      .subscribe-form {
        display: grid;
        gap: 20px;
      }

      .form-group {
        display: grid;
        gap: 8px;
      }

      .form-label {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .form-input,
      .form-select {
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 12px 16px;
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-primary);
        background: var(--surface);
        transition: border 0.2s ease, box-shadow 0.2s ease;
        font-family: inherit;
      }

      .form-input:focus,
      .form-select:focus {
        outline: none;
        border-color: var(--purple);
        box-shadow: 0 0 0 3px rgba(91, 58, 157, 0.15);
      }

      .form-submit-button {
        margin-top: 8px;
        border: none;
        border-radius: var(--radius-pill);
        padding: 14px 32px;
        font-size: 1rem;
        font-weight: 700;
        color: white;
        background: var(--purple);
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(75, 35, 140, 0.35);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .form-submit-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(75, 35, 140, 0.5);
      }

      .form-submit-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      /* Certification upload styles */
      .cert-upload-wrapper {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
      }

      .cert-add-button {
        border: none;
        border-radius: var(--radius-md);
        padding: 12px 20px;
        font-size: 0.95rem;
        font-weight: 600;
        color: white;
        background: var(--purple);
        cursor: pointer;
        transition: opacity 0.2s ease, background 0.2s ease;
        white-space: nowrap;
      }

      .cert-add-button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .cert-add-button:not(:disabled):hover {
        background: var(--violet);
      }

      .uploaded-certs-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
        max-height: 300px;
        overflow-y: auto;
        padding-right: 8px;
      }

      .uploaded-certs-list::-webkit-scrollbar {
        width: 8px;
      }

      .uploaded-certs-list::-webkit-scrollbar-track {
        background: var(--surface-muted);
        border-radius: 4px;
      }

      .uploaded-certs-list::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 4px;
        transition: background 0.2s ease;
      }

      .uploaded-certs-list::-webkit-scrollbar-thumb:hover {
        background: var(--purple);
      }

      .uploaded-cert-card {
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 14px;
        background: var(--surface);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        transition: box-shadow 0.2s ease;
      }

      .uploaded-cert-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .cert-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .cert-card-title {
        font-weight: 700;
        font-size: 0.95rem;
        color: var(--purple);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .cert-card-remove {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: rgba(91, 58, 157, 0.1);
        color: var(--purple);
        font-size: 18px;
        font-weight: 700;
        line-height: 1;
        cursor: pointer;
        transition: background 0.2s ease;
        border: none;
      }

      .cert-card-remove:hover {
        background: rgba(91, 58, 157, 0.25);
      }

      .cert-card-body {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .cert-thumbnail {
        width: 60px;
        height: 60px;
        border-radius: 8px;
        overflow: hidden;
        background: var(--surface-muted);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        border: 1px solid var(--border);
      }

      .cert-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .cert-file-icon {
        font-size: 28px;
        color: var(--text-secondary);
      }

      .cert-file-info {
        flex: 1;
        min-width: 0;
      }

      .cert-file-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 4px;
      }

      .cert-file-size {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      /* Required field asterisk */
      .required-asterisk {
        color: #dc2626;
        margin-left: 2px;
      }

      /* Desktop-only search section title */
      .search-section-title {
        color: white;
        font-size: 2rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 32px;
        letter-spacing: -0.02em;
      }

      @media (max-width: 768px) {
        .search-section-title {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <nav class="nav">
          <div class="brand">
            <div class="brand-mark">
              <img src="/attached_assets/GigSafe_Logo_1762548362018.png" alt="GigSafe Logo" />
            </div>
            GigSafe's Final Mile Board
          </div>
          <div class="nav-links">
            <button class="subscribe-button" id="subscribeButton" aria-label="Subscribe to job alerts">
              <svg class="bell-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
              </svg>
              <span class="subscribe-text">Subscribe</span>
            </button>
          </div>
        </nav>
      </header>

      <main>
        <section class="hero">
          <div class="hero-content">
            <h1 class="search-section-title">Master List of Public Job Boards</h1>
            <div class="search-card">
              <div class="search-group">
                <label class="search-label" for="keyword">Keyword</label>
                <input
                  class="search-input"
                  id="keyword"
                  name="keyword"
                  placeholder=""
                />
              </div>
              <div class="search-group">
                <label class="search-label" for="city">City</label>
                <select class="search-select" id="city" name="city">
                  <option value="">Any</option>
                </select>
              </div>
              <div class="search-group">
                <label class="search-label" for="state">State</label>
                <select class="search-select" id="state" name="state">
                  <option value="">Any</option>
                  <option>AL</option>
                  <option>AK</option>
                  <option>AZ</option>
                  <option>AR</option>
                  <option>CA</option>
                  <option>CO</option>
                  <option>CT</option>
                  <option>DE</option>
                  <option>FL</option>
                  <option>GA</option>
                  <option>HI</option>
                  <option>ID</option>
                  <option>IL</option>
                  <option>IN</option>
                  <option>IA</option>
                  <option>KS</option>
                  <option>KY</option>
                  <option>LA</option>
                  <option>ME</option>
                  <option>MD</option>
                  <option>MA</option>
                  <option>MI</option>
                  <option>MN</option>
                  <option>MS</option>
                  <option>MO</option>
                  <option>MT</option>
                  <option>NE</option>
                  <option>NV</option>
                  <option>NH</option>
                  <option>NJ</option>
                  <option>NM</option>
                  <option>NY</option>
                  <option>NC</option>
                  <option>ND</option>
                  <option>OH</option>
                  <option>OK</option>
                  <option>OR</option>
                  <option>PA</option>
                  <option>RI</option>
                  <option>SC</option>
                  <option>SD</option>
                  <option>TN</option>
                  <option>TX</option>
                  <option>UT</option>
                  <option>VT</option>
                  <option>VA</option>
                  <option>WA</option>
                  <option>WV</option>
                  <option>WI</option>
                  <option>WY</option>
                </select>
              </div>
              <div class="search-group">
                <label class="search-label" for="vehicle">Vehicle</label>
                <select class="search-select" id="vehicle" name="vehicle">
                  <option>Any</option>
                  <option>Bicycle</option>
                  <option>Sedan</option>
                  <option>SUV</option>
                  <option>Truck</option>
                  <option>Mini Van</option>
                  <option>Cargo/Sprinter Van</option>
                  <option>Box Truck</option>
                </select>
              </div>
              <div class="search-group">
                <label class="search-label" for="certifications"
                  >Certifications</label
                >
                <select
                  class="search-select"
                  id="certifications"
                  name="certifications"
                >
                  <option value="">None</option>
                  <option value="HIPAA">HIPAA</option>
                  <option value="BPP">BPP</option>
                  <option value="TWIC">TWIC</option>
                  <option value="TSA">TSA</option>
                  <option value="STA">STA</option>
                  <option value="HAZMAT">HAZMAT</option>
                </select>
              </div>
              <div class="search-actions">
                <button class="search-button" type="button">Search Jobs</button>
              </div>
            </div>

            <!-- Selected Certifications Tags -->
            <div
              class="certifications-tags-container"
              id="certificationsContainer"
              style="margin-top: 20px; display: none"
            >
              <div class="certifications-label">Selected Certifications:</div>
              <div class="certifications-tags" id="certificationsTags"></div>
            </div>
          </div>
        </section>

        <!-- Jobs Listing Section -->
        <section class="jobs-section">
          <div class="jobs-container">
            <div class="jobs-header">
              <h2 class="section-title">Available Jobs</h2>
              <div class="jobs-count" id="jobsCount">Loading...</div>
            </div>
            <div class="jobs-scroll-area" id="jobsScrollArea">
              <div class="jobs-grid" id="jobsGrid"></div>
              <div
                class="loading-spinner"
                id="loadingSpinner"
                style="display: none"
              ></div>
              <div class="no-more-jobs" id="noMoreJobs" style="display: none">
                No more jobs to load
              </div>
              <div class="jobs-sentinel" id="jobsSentinel"></div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Subscribe Modal -->
    <div class="modal-overlay" id="subscribeModal">
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title">Subscribe</h2>
          <button class="modal-close" id="closeModal" aria-label="Close modal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="subscribeForm" class="subscribe-form">
            <div class="form-group">
              <label class="form-label" for="firstName"
                >First Name <span class="required-asterisk">*</span></label
              >
              <input
                type="text"
                id="firstName"
                name="firstName"
                class="form-input"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="lastName"
                >Last Name <span class="required-asterisk">*</span></label
              >
              <input
                type="text"
                id="lastName"
                name="lastName"
                class="form-input"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="email"
                >Email <span class="required-asterisk">*</span></label
              >
              <input
                type="email"
                id="email"
                name="email"
                class="form-input"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="subscribeCity"
                >City <span class="required-asterisk">*</span></label
              >
              <input
                type="text"
                id="subscribeCity"
                name="city"
                class="form-input"
                placeholder="Enter your city"
                required
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="subscribeState"
                >State <span class="required-asterisk">*</span></label
              >
              <select
                id="subscribeState"
                name="state"
                class="form-select"
                required
              >
                <option value="">Select State</option>
                <option>AL</option>
                <option>AK</option>
                <option>AZ</option>
                <option>AR</option>
                <option>CA</option>
                <option>CO</option>
                <option>CT</option>
                <option>DE</option>
                <option>FL</option>
                <option>GA</option>
                <option>HI</option>
                <option>ID</option>
                <option>IL</option>
                <option>IN</option>
                <option>IA</option>
                <option>KS</option>
                <option>KY</option>
                <option>LA</option>
                <option>ME</option>
                <option>MD</option>
                <option>MA</option>
                <option>MI</option>
                <option>MN</option>
                <option>MS</option>
                <option>MO</option>
                <option>MT</option>
                <option>NE</option>
                <option>NV</option>
                <option>NH</option>
                <option>NJ</option>
                <option>NM</option>
                <option>NY</option>
                <option>NC</option>
                <option>ND</option>
                <option>OH</option>
                <option>OK</option>
                <option>OR</option>
                <option>PA</option>
                <option>RI</option>
                <option>SC</option>
                <option>SD</option>
                <option>TN</option>
                <option>TX</option>
                <option>UT</option>
                <option>VT</option>
                <option>VA</option>
                <option>WA</option>
                <option>WV</option>
                <option>WI</option>
                <option>WY</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="modalCertifications"
                >Certifications</label
              >
              <div class="cert-upload-wrapper">
                <select id="modalCertifications" class="form-select">
                  <option value="">None</option>
                  <option>HIPPA</option>
                  <option>BPP</option>
                  <option>STA</option>
                  <option>TSA</option>
                  <option>TWIC</option>
                  <option>CDA</option>
                  <option>NSA</option>
                  <option>CIA</option>
                  <option>FBI</option>
                  <option>PBS</option>
                </select>
                <input
                  type="file"
                  id="certFileInput"
                  class="cert-file-input"
                  style="display: none"
                />
                <button
                  type="button"
                  id="addCertButton"
                  class="cert-add-button"
                  disabled
                >
                  Add File
                </button>
              </div>
            </div>

            <!-- Uploaded Certifications Preview -->
            <div
              class="form-group"
              id="uploadedCertsContainer"
              style="display: none"
            >
              <label class="form-label">Uploaded Certifications</label>
              <div class="uploaded-certs-list" id="uploadedCertsList"></div>
            </div>

            <button type="submit" class="form-submit-button">Subscribe</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Fuse.js for fuzzy search -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>

    <script>
      // Analytics tracking utility
      (function() {
        // Get or create session ID
        let sessionId = sessionStorage.getItem('analytics_session_id');
        if (!sessionId) {
          sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          sessionStorage.setItem('analytics_session_id', sessionId);
        }

        // Track event function
        window.trackEvent = function(eventType, eventData = {}) {
          // Fire and forget - don't wait for response
          fetch('/api/analytics', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              event_type: eventType,
              event_data: eventData,
              session_id: sessionId
            })
          }).catch(() => {}); // Silently fail - don't break user experience
        };

        // Track page visit once per session
        if (!sessionStorage.getItem('analytics_page_visited')) {
          trackEvent('page_visit');
          sessionStorage.setItem('analytics_page_visited', 'true');
        }
      })();

      // Jobs infinite scroll functionality
      console.log("==============================");
      console.log("Jobs script initializing...");
      console.log("==============================");

      let currentPage = 0;
      let isLoading = false;
      let hasMoreJobs = true;
      let totalJobs = 0;
      let loadedJobs = 0;
      let observer;
      let allLoadedJobs = []; // Store all loaded jobs for client-side fuzzy search
      let fuse = null; // Fuse.js instance
      let activeFilters = null; // Persist filters across pagination

      const API_URL = "/api/jobs";
      console.log("API URL configured:", API_URL);

      const jobsGrid = document.getElementById("jobsGrid");
      const jobsScrollArea = document.getElementById("jobsScrollArea");
      const jobsSentinel = document.getElementById("jobsSentinel");
      const loadingSpinner = document.getElementById("loadingSpinner");
      const noMoreJobs = document.getElementById("noMoreJobs");
      const jobsCount = document.getElementById("jobsCount");
      const keywordInput = document.getElementById("keyword");
      const citySelect = document.getElementById("city");
      const stateSelect = document.getElementById("state");
      const vehicleSelect = document.getElementById("vehicle");
      const certificationsSelect = document.getElementById("certifications");
      const certificationsContainer = document.getElementById(
        "certificationsContainer",
      );
      const certificationsTags = document.getElementById("certificationsTags");
      const searchButton = document.querySelector(".search-button");
      const searchButtonDefaultText = searchButton
        ? searchButton.textContent
        : "Search Jobs";

      console.log("DOM elements found:", {
        jobsGrid: !!jobsGrid,
        jobsScrollArea: !!jobsScrollArea,
        jobsSentinel: !!jobsSentinel,
        loadingSpinner: !!loadingSpinner,
        noMoreJobs: !!noMoreJobs,
        jobsCount: !!jobsCount,
        citySelect: !!citySelect,
        stateSelect: !!stateSelect,
        certificationsSelect: !!certificationsSelect,
        certificationsContainer: !!certificationsContainer,
        certificationsTags: !!certificationsTags,
      });

      // Cities data
      let citiesData = null;

      // Certifications data
      const selectedCertifications = [];

      // Consistent color mapping for certifications
      const certificationColors = {
        'HIPAA': { bg: '#E8D5F2', text: '#6B3FA0' },      // Soft lavender (medical/health)
        'BPP': { bg: '#D5E8F7', text: '#2E5C8A' },        // Light blue (professional)
        'TWIC': { bg: '#D5F2E8', text: '#2E8A6B' },       // Soft teal (maritime/security)
        'TSA': { bg: '#FFE5CC', text: '#CC7A29' },        // Light orange (aviation)
        'STA': { bg: '#D5F7E8', text: '#2E8A5C' },        // Soft green (aviation/security)
        'HAZMAT': { bg: '#FFD5D5', text: '#CC4040' }      // Light coral (caution/safety)
      };

      // Consistent color mapping for vehicle types
      const vehicleColors = {
        'Car': { bg: '#E3F2FD', text: '#1565C0' },        // Light blue
        'Van': { bg: '#F3E5F5', text: '#7B1FA2' },        // Light purple
        'Truck': { bg: '#FFF3E0', text: '#E65100' },      // Light orange
        'SUV': { bg: '#E8F5E9', text: '#2E7D32' },        // Light green
        'Bike': { bg: '#FCE4EC', text: '#C2185B' },       // Light pink
        'Motorcycle': { bg: '#FFF9C4', text: '#F57F17' }, // Light yellow
        'Box Truck': { bg: '#FFECB3', text: '#FF6F00' },  // Light amber
        'Cargo Van': { bg: '#E1BEE7', text: '#6A1B9A' },  // Light deep purple
        'Sprinter Van': { bg: '#D1C4E9', text: '#512DA8' } // Light indigo
      };

      // Fallback colors for unknown types
      const defaultTagColor = { bg: '#F5F5F5', text: '#616161' };

      function setSearchLoading(isSearching) {
        if (!searchButton) {
          return;
        }

        if (isSearching) {
          searchButton.disabled = true;
          searchButton.textContent = "Searching...";
        } else {
          searchButton.disabled = false;
          searchButton.textContent = searchButtonDefaultText;
        }
      }

      function normalizeFilters(raw = {}) {
        return {
          keyword: raw.keyword?.trim() || "",
          state: raw.state || "",
          city: raw.city || "",
          vehicle: raw.vehicle || "",
          certifications: Array.isArray(raw.certifications)
            ? raw.certifications.filter(Boolean)
            : [],
        };
      }

      function getCurrentFilters() {
        console.log(" getCurrentFilters() called");
        console.log(" selectedCertifications array:", selectedCertifications);
        const rawFilters = {
          keyword: keywordInput?.value,
          state: stateSelect?.value,
          city: citySelect?.value,
          vehicle: vehicleSelect?.value,
          certifications: [...selectedCertifications],
        };
        console.log(" Raw filters before normalize:", rawFilters);
        const normalized = normalizeFilters(rawFilters);
        console.log(" Normalized filters:", normalized);
        return normalized;
      }

      function shouldUseFuzzySearch(filters) {
        if (!filters.keyword) return false;
        if (filters.state || filters.city || filters.vehicle) return false;
        if (filters.certifications.length > 0) return false;
        if (!fuse || allLoadedJobs.length === 0) return false;
        return !hasMoreJobs;
      }

      // Load cities data from JSON
      async function loadCitiesData() {
        try {
          console.log("Loading cities data...");
          const response = await fetch("cities_by_state.json");
          citiesData = await response.json();
          console.log(
            "Cities data loaded:",
            Object.keys(citiesData).length - 1,
            "states",
          );

          // Initialize city dropdown with all cities
          populateCities("");
        } catch (error) {
          console.error("Failed to load cities data:", error);
        }
      }

      // Populate city dropdown based on selected state
      function populateCities(selectedState) {
        if (!citiesData || !citySelect) return;

        console.log("Populating cities for state:", selectedState || "All");

        // Clear existing options except "Any"
        citySelect.innerHTML = '<option value="">Any</option>';

        // Get cities for the selected state or all cities
        const cities =
          selectedState && selectedState !== ""
            ? citiesData[selectedState] || []
            : citiesData.allCities || [];

        console.log(`  Found ${cities.length} cities`);

        // Add city options
        cities.forEach((city) => {
          const option = document.createElement("option");
          option.value = city;
          option.textContent = city;
          citySelect.appendChild(option);
        });
      }

      // Handle state selection change
      if (stateSelect) {
        stateSelect.addEventListener("change", (e) => {
          const selectedState = e.target.value;
          console.log("State changed to:", selectedState || "Any");

          // Track filter change
          trackEvent('filter_change', {
            filter_type: 'state',
            value: selectedState || 'Any'
          });

          // Reset city to "Any"
          if (citySelect) {
            citySelect.value = "";
          }

          // Repopulate cities
          populateCities(selectedState);

          // Trigger search with new state filter
          triggerSearch();
        });
      }

      // Handle city selection change
      if (citySelect) {
        citySelect.addEventListener("change", () => {
          console.log("City changed to:", citySelect.value || "Any");

          // Track filter change
          trackEvent('filter_change', {
            filter_type: 'city',
            value: citySelect.value || 'Any'
          });

          // Trigger search with new city filter
          triggerSearch();
        });
      }

      // Handle vehicle selection change
      if (vehicleSelect) {
        vehicleSelect.addEventListener("change", () => {
          console.log("Vehicle changed to:", vehicleSelect.value || "Any");

          // Track filter change
          trackEvent('filter_change', {
            filter_type: 'vehicle',
            value: vehicleSelect.value || 'Any'
          });

          // Trigger search with new vehicle filter
          triggerSearch();
        });
      }

      // Certifications tag management
      function addCertification(cert) {
        if (!cert || selectedCertifications.includes(cert)) {
          console.log(" Cert already selected or invalid:", cert);
          return;
        }

        console.log(" Adding certification:", cert);

        // Add to selected array
        selectedCertifications.push(cert);
        console.log(" selectedCertifications array is now:", selectedCertifications);

        // Create tag element
        const tag = document.createElement("div");
        tag.className = "cert-tag";
        tag.dataset.cert = cert;

        // Get colors from color map
        const colors = certificationColors[cert] || defaultTagColor;
        tag.style.backgroundColor = colors.bg;
        tag.style.color = colors.text;
        tag.style.fontWeight = "600";

        // Tag content
        tag.innerHTML = `
          <span>${cert}</span>
          <span class="cert-tag-remove">&times;</span>
        `;

        // Add click handler for remove button
        tag.querySelector(".cert-tag-remove").addEventListener("click", (e) => {
          e.stopPropagation();
          removeCertification(cert);
        });

        // Add tag to container
        certificationsTags.appendChild(tag);

        // Show container if hidden
        if (certificationsContainer) {
          certificationsContainer.style.display = "block";
        }

        // Disable this option in dropdown
        const option = certificationsSelect.querySelector(
          `option[value="${cert}"]`,
        );
        if (option) {
          option.disabled = true;
          option.style.display = "none";
        }

        // Reset dropdown
        certificationsSelect.value = "";
      }

      function removeCertification(cert) {
        console.log(" Removing certification:", cert);

        // Remove from selected array
        const index = selectedCertifications.indexOf(cert);
        if (index > -1) {
          selectedCertifications.splice(index, 1);
          console.log(" selectedCertifications array is now:", selectedCertifications);
        }

        // Remove tag element
        const tag = certificationsTags.querySelector(`[data-cert="${cert}"]`);
        if (tag) {
          tag.remove();
        }

        // Re-enable option in dropdown
        const option = certificationsSelect.querySelector(
          `option[value="${cert}"]`,
        );
        if (option) {
          option.disabled = false;
          option.style.display = "";
        }

        // Hide container if no certifications
        if (selectedCertifications.length === 0 && certificationsContainer) {
          certificationsContainer.style.display = "none";
        }

        // Auto-trigger search when certification is removed
        console.log(" About to call fetchJobs(1) - AUTO-TRIGGER ON REMOVE");
        fetchJobs(1);
        console.log(" fetchJobs(1) call completed");
      }

      // Handle certification selection
      if (certificationsSelect) {
        certificationsSelect.addEventListener("change", (e) => {
          console.log(" Certification dropdown changed!");
          const cert = e.target.value;
          console.log(" Selected cert value:", cert);
          if (cert) {
            console.log(" About to call addCertification()");
            addCertification(cert);
            console.log(" addCertification() completed");
            console.log(" About to call fetchJobs(1) - AUTO-TRIGGER");
            // Auto-trigger search when certification is selected
            fetchJobs(1);
            console.log(" fetchJobs(1) call completed");
          }
        });
      }

      async function fetchJobs(page = 1, filtersOverride = null) {
        console.log(`fetchJobs called with page: ${page}`);
        console.log("isLoading:", isLoading);
        console.log("hasMoreJobs:", hasMoreJobs);

        const isNewSearch = page === 1;
        // For new searches, always get current filters to pick up certification changes
        const filtersSource = isNewSearch && !filtersOverride
          ? getCurrentFilters()
          : (filtersOverride ?? activeFilters ?? getCurrentFilters());
        const filters = normalizeFilters(filtersSource);

        if (!activeFilters || isNewSearch || filtersOverride) {
          activeFilters = {
            ...filters,
            certifications: [...filters.certifications],
          };
          console.log(" Active filters set to:", activeFilters);
          console.log(" Certifications in filter:", activeFilters.certifications);
        }

        if (isLoading || (!hasMoreJobs && !isNewSearch)) {
          console.log("Fetch aborted - already loading or no more jobs");
          return;
        }

        if (isNewSearch) {
          setSearchLoading(true);
          currentPage = 0;
          loadedJobs = 0;
          jobsGrid.innerHTML = "";
          hasMoreJobs = true;
          allLoadedJobs = []; // Reset loaded jobs array
        }

        jobsGrid
          .querySelectorAll(".jobs-error, .jobs-empty")
          .forEach((node) => node.remove());

        isLoading = true;
        loadingSpinner.style.display = "block";
        noMoreJobs.style.display = "none";

        // Build query parameters with filters
        const params = new URLSearchParams({
          page: page.toString(),
          limit: "20",
        });

        // Add filters
        if (filters.keyword) params.append("keyword", filters.keyword);
        if (filters.state) params.append("state", filters.state);
        if (filters.city) params.append("city", filters.city);
        if (filters.vehicle && filters.vehicle !== "Any")
          params.append("vehicle", filters.vehicle);
        if (filters.certifications.length > 0) {
          params.append("certifications", filters.certifications.join(","));
        }

        const fetchURL = `${API_URL}?${params.toString()}`;
        console.log("Fetching:", fetchURL);
        console.log("Filters:", filters);

        try {
          const response = await fetch(fetchURL);
          console.log("Response status:", response.status);
          console.log("Response OK:", response.ok);

          if (!response.ok) {
            throw new Error(`Request failed with status ${response.status}`);
          }

          const data = await response.json();
          console.log("Data received:", {
            success: data.success,
            jobsCount: data.data?.length,
            totalJobs: data.pagination?.totalJobs,
            hasMore: data.pagination?.hasMore,
          });

          if (!data.success) {
            throw new Error(data.error || "Unknown API error");
          }

          totalJobs = data.pagination.totalJobs;
          hasMoreJobs = data.pagination.hasMore;

          console.log("Rendering", data.data.length, "jobs");

          // Add jobs to our loaded jobs array for fuzzy search
          allLoadedJobs = allLoadedJobs.concat(data.data);

          // Update Fuse.js index with all loaded jobs
          updateFuseIndex();

          renderJobs(data.data);
          updateJobsCount();
          currentPage = page;

          console.log("Page loaded successfully");
          console.log(`  Total jobs: ${totalJobs}`);
          console.log(`  Loaded so far: ${loadedJobs}`);
          console.log(`  Has more: ${hasMoreJobs}`);

          if (!hasMoreJobs) {
            if (loadedJobs > 0) {
              noMoreJobs.style.display = "block";
            }
          }
        } catch (error) {
          console.error("Error fetching jobs:");
          console.error("Error type:", error.name);
          console.error("Error message:", error.message);
          console.error("Full error:", error);

          let errorMessage = "Failed to load jobs. ";
          if (error.message.includes("Failed to fetch")) {
            errorMessage +=
              'Cannot connect to API server. Make sure you ran "npm start" to start both servers.';
          } else {
            errorMessage += error.message;
          }

          showJobsError(errorMessage);
        } finally {
          isLoading = false;
          loadingSpinner.style.display = "none";
          if (isNewSearch) {
            setSearchLoading(false);
          }
        }
      }
      function updateJobsCount() {
        if (totalJobs === 0) {
          jobsCount.textContent = "No jobs available yet";
          return;
        }

        const showing = Math.min(loadedJobs, totalJobs);
        jobsCount.textContent = `Showing ${showing} of ${totalJobs} jobs`;
      }

      function renderJobs(jobs) {
        if (!jobs.length && loadedJobs === 0) {
          jobsGrid.innerHTML =
            '<div class="jobs-empty">No jobs available yet</div>';
          return;
        }

        if (jobsGrid.firstElementChild?.classList.contains("jobs-empty")) {
          jobsGrid.innerHTML = "";
        }

        jobs.forEach((job) => {
          const jobCard = createJobCard(job);
          jobsGrid.appendChild(jobCard);
          loadedJobs += 1;
        });
      }

      function showJobsError(message) {
        const existingError = jobsGrid.querySelector(".jobs-error");
        if (existingError) {
          existingError.textContent = message;
          return;
        }

        const error = document.createElement("div");
        error.className = "jobs-error";
        error.textContent = message;
        jobsGrid.appendChild(error);
      }

      // Create job card element
      function createJobCard(job) {
        const card = document.createElement("div");
        card.className = "job-item";
        card.onclick = () => {
          // Track job click with Posthog
          if (typeof posthog !== "undefined") {
            posthog.capture("job_click", {
              job_id: job.id,
              job_title: job.title,
              company: job.company,
              location: `${job.city}, ${job.state}`,
              pay: job.pay,
              source_company: job.source_company,
              vehicle_requirements: job.vehicle_requirements,
            });
          }

          // Track job click with custom analytics
          trackEvent('job_click', {
            title: job.title,
            company: job.company,
            location: `${job.city}, ${job.state}`
          });

          // Open job URL
          window.open(job.job_url, "_blank");
        };

        // Apply gold styling and sash if user-submitted
        if (job.submitted_at) {
          card.classList.add("job-item--user-submitted"); // Add a class for potential future styling
          card.dataset.userSubmitted = "true"; // Add a data attribute for CSS targeting
        }


        const location =
          [job.city, job.state].filter(Boolean).join(", ") ||
          "Location not specified";
        const description = job.description || "No description available";

        let certificationBadges = '';
        if (job.certifications_required) {
          const certs = job.certifications_required.split(',').map(c => c.trim()).filter(Boolean);
          certificationBadges = certs.map(cert => {
            const colors = certificationColors[cert] || defaultTagColor;
            return `<span class="job-tag cert-tag" style="background-color: ${colors.bg}; color: ${colors.text}; font-weight: 600;">${escapeHtml(cert)}</span>`;
          }).join('');
        }

        let vehicleBadge = '';
        if (job.vehicle_requirements) {
          const vehicle = job.vehicle_requirements.trim();
          const colors = vehicleColors[vehicle] || defaultTagColor;
          vehicleBadge = `<span class="job-tag vehicle-tag" style="background-color: ${colors.bg}; color: ${colors.text}; font-weight: 600;">${escapeHtml(vehicle)}</span>`;
        }

        card.innerHTML = `
          <div class="job-item-header">
            <div>
              <h3 class="job-item-title">${escapeHtml(job.title || "Job Title Not Available")}</h3>
              <div class="job-item-company">${escapeHtml(job.company || "Company Not Specified")}</div>
              <div class="job-item-location">${escapeHtml(location)}</div>
            </div>
            ${job.pay ? `<div class="job-item-pay">${escapeHtml(job.pay)}</div>` : ""}
          </div>
          <div class="job-item-description">${escapeHtml(description)}</div>
          <div class="job-item-tags">
            ${vehicleBadge}
            ${certificationBadges}
          </div>
        `;

        return card;
      }

      // Escape HTML to prevent XSS
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function setupIntersectionObserver() {
        if (!jobsSentinel) {
          return;
        }

        observer?.disconnect();

        // Check if we're on mobile (no max-height on scroll area)
        const isMobile = window.innerWidth <= 768;

        // On mobile, use viewport (root: null) for scrolling detection
        // On desktop, use the scroll area container
        const observerOptions = isMobile
          ? { root: null, rootMargin: "0px 0px 200px 0px" }
          : { root: jobsScrollArea, rootMargin: "0px 0px 200px 0px" };

        observer = new IntersectionObserver((entries) => {
          const [entry] = entries;

          if (entry?.isIntersecting && !isLoading && hasMoreJobs) {
            const nextPage = currentPage + 1 || 1;
            fetchJobs(nextPage);
          }
        }, observerOptions);

        observer.observe(jobsSentinel);
      }

      // Re-setup observer on window resize to handle mobile/desktop transitions
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          setupIntersectionObserver();
        }, 250);
      });

      // Update Fuse.js index with loaded jobs
      function updateFuseIndex() {
        if (typeof Fuse === "undefined") {
          console.log("Fuse.js not loaded yet");
          return;
        }

        const fuseOptions = {
          keys: [
            { name: "title", weight: 0.3 },
            { name: "description", weight: 0.25 },
            { name: "schedule_details", weight: 0.2 },
            { name: "company", weight: 0.15 },
            { name: "benefits", weight: 0.05 },
            { name: "general_requirements", weight: 0.05 },
          ],
          threshold: 0.4, // 0.0 = perfect match, 1.0 = match anything
          includeScore: true,
          minMatchCharLength: 2,
          ignoreLocation: true,
        };

        fuse = new Fuse(allLoadedJobs, fuseOptions);
        console.log("Fuse.js index updated with", allLoadedJobs.length, "jobs");
      }

      // Apply fuzzy search filter on loaded jobs
      function applyFuzzySearch(keyword) {
        if (!keyword || !fuse || allLoadedJobs.length === 0) {
          // No keyword or no jobs loaded, show all
          renderJobs(allLoadedJobs);
          return;
        }

        console.log("Applying fuzzy search for:", keyword);
        const results = fuse.search(keyword);
        console.log("Found", results.length, "fuzzy matches");

        // Extract job objects from Fuse results
        const matchedJobs = results.map((result) => result.item);

        // Clear and render matched jobs
        jobsGrid.innerHTML = "";
        loadedJobs = 0;
        renderJobs(matchedJobs);

        // Update count
        jobsCount.textContent = `Showing ${matchedJobs.length} of ${allLoadedJobs.length} loaded jobs (fuzzy search)`;
      }

      // Trigger search
      function triggerSearch() {
        console.log("Search triggered!");

        const filters = getCurrentFilters();

        // Track analytics - search or filter
        if (filters.keyword) {
          trackEvent('search', { keyword: filters.keyword });
        }
        if (filters.state || filters.city || filters.vehicle !== 'Any') {
          trackEvent('filter', { 
            state: filters.state, 
            city: filters.city, 
            vehicle: filters.vehicle 
          });
        }

        const useFuzzy = shouldUseFuzzySearch(filters);

        if (useFuzzy) {
          console.log(
            "Using client-side fuzzy search on",
            allLoadedJobs.length,
            "loaded jobs",
          );
          setSearchLoading(true);
          activeFilters = {
            ...filters,
            certifications: [...filters.certifications],
          };
          applyFuzzySearch(filters.keyword);
          setSearchLoading(false);
          return;
        }

        console.log("Fetching from server with filters");
        fetchJobs(1, filters);
      }
      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        console.log("DOMContentLoaded event fired!");
        console.log("Initializing jobs system...");

        // Load cities data first
        loadCitiesData();

        // Setup search button
        if (searchButton) {
          searchButton.addEventListener("click", triggerSearch);
          console.log("Search button event listener attached");
        }

        // Setup Enter key on keyword input
        if (keywordInput) {
          keywordInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              triggerSearch();
            }
          });
          console.log("Keyword input Enter key listener attached");
        }

        // Setup subscribe modal
        const subscribeButton = document.getElementById("subscribeButton");
        const subscribeModal = document.getElementById("subscribeModal");
        const closeModalButton = document.getElementById("closeModal");

        // Function to update subscribe button state
        function updateSubscribeButton() {
          if (!subscribeButton) return;

          const subscribeTextSpan = subscribeButton.querySelector(".subscribe-text");
          const hasSubscribed =
            sessionStorage.getItem("hasSubscribed") === "true";

          if (hasSubscribed) {
            if (subscribeTextSpan) {
              subscribeTextSpan.textContent = "Subscribed";
            }
            subscribeButton.classList.add("subscribed");
            subscribeButton.disabled = true;
          } else {
            if (subscribeTextSpan) {
              subscribeTextSpan.textContent = "Subscribe";
            }
            subscribeButton.classList.remove("subscribed");
            subscribeButton.disabled = false;
          }
        }

        // Check subscription state on load
        updateSubscribeButton();

        if (subscribeButton && subscribeModal) {
          // Open modal when subscribe button is clicked
          subscribeButton.addEventListener("click", () => {
            if (subscribeButton.disabled) return; // Don't open if subscribed
            subscribeModal.classList.add("active");
            document.body.style.overflow = "hidden"; // Prevent background scrolling
          });

          // Close modal when close button is clicked
          if (closeModalButton) {
            closeModalButton.addEventListener("click", () => {
              subscribeModal.classList.remove("active");
              document.body.style.overflow = ""; // Restore scrolling
            });
          }

          // Close modal when clicking outside the modal container
          subscribeModal.addEventListener("click", (e) => {
            if (e.target === subscribeModal) {
              subscribeModal.classList.remove("active");
              document.body.style.overflow = ""; // Restore scrolling
            }
          });

          // Close modal on Escape key
          document.addEventListener("keydown", (e) => {
            if (
              e.key === "Escape" &&
              subscribeModal.classList.contains("active")
            ) {
              subscribeModal.classList.remove("active");
              document.body.style.overflow = ""; // Restore scrolling
            }
          });

          console.log("Subscribe modal event listeners attached");
        }

        // Setup certification upload in modal
        const modalCertSelect = document.getElementById("modalCertifications");
        const certFileInput = document.getElementById("certFileInput");
        const addCertButton = document.getElementById("addCertButton");
        const uploadedCertsContainer = document.getElementById(
          "uploadedCertsContainer",
        );
        const uploadedCertsList = document.getElementById("uploadedCertsList");
        const subscribeForm = document.getElementById("subscribeForm");

        let uploadedCertifications = []; // Array of {cert: string, file: File, thumbnail: string}

        // Generate image thumbnail using FileReader
        function generateImageThumbnail(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => {
              resolve(e.target.result);
            };
            reader.onerror = () => {
              reject(new Error("Failed to read file"));
            };
            reader.readAsDataURL(file);
          });
        }

        // Format file size in human-readable format
        function formatFileSize(bytes) {
          if (bytes === 0) return "0 Bytes";
          const k = 1024;
          const sizes = ["Bytes", "KB", "MB", "GB"];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return (
            Math.round((bytes / Math.pow(k, i)) * 100) / 100 + " " + sizes[i]
          );
        }

        // Get file icon based on file type
        function getFileIcon(fileType) {
          if (fileType.startsWith("image/")) return "IMG";
          if (fileType === "application/pdf") return "PDF";
          if (fileType.includes("word") || fileType.includes("document"))
            return "DOC";
          if (fileType.includes("spreadsheet") || fileType.includes("excel"))
            return "XLS";
          if (fileType.includes("zip") || fileType.includes("compressed"))
            return "ZIP";
          return "FILE";
        }

        if (modalCertSelect && certFileInput && addCertButton) {
          // Enable "Add File" button when certification is selected
          modalCertSelect.addEventListener("change", () => {
            addCertButton.disabled = !modalCertSelect.value;
          });

          // Trigger file input when "Add File" button is clicked
          addCertButton.addEventListener("click", () => {
            const selectedCert = modalCertSelect.value;
            if (selectedCert) {
              certFileInput.dataset.selectedCert = selectedCert;
              certFileInput.click();
            }
          });

          // Handle file selection
          certFileInput.addEventListener("change", async (e) => {
            const file = e.target.files[0];
            const selectedCert = certFileInput.dataset.selectedCert;

            if (file && selectedCert) {
              // Generate thumbnail if it's an image
              let thumbnailDataUrl = null;
              if (file.type.startsWith("image/")) {
                thumbnailDataUrl = await generateImageThumbnail(file);
              }

              // Add to uploaded certifications array
              uploadedCertifications.push({
                cert: selectedCert,
                file: file,
                thumbnail: thumbnailDataUrl,
              });

              // Create tag
              renderUploadedCertifications();

              // Reset dropdown and file input
              modalCertSelect.value = "";
              certFileInput.value = "";
              delete certFileInput.dataset.selectedCert;
              addCertButton.disabled = true;

              // Show uploaded certifications container
              if (uploadedCertsContainer) {
                uploadedCertsContainer.style.display = "block";
              }
            }
          });

          console.log("Certification upload event listeners attached");
        }

        // Render uploaded certifications as preview cards
        function renderUploadedCertifications() {
          if (!uploadedCertsList) return;

          uploadedCertsList.innerHTML = "";

          uploadedCertifications.forEach((item, index) => {
            const card = document.createElement("div");
            card.className = "uploaded-cert-card";

            // Create thumbnail or icon
            let thumbnailHTML;
            if (item.thumbnail) {
              // Image thumbnail
              thumbnailHTML = `<img src="${item.thumbnail}" alt="${item.file.name}" />`;
            } else {
              // File icon for non-images
              const icon = getFileIcon(item.file.type);
              thumbnailHTML = `<span class="cert-file-icon">${icon}</span>`;
            }

            card.innerHTML = `
              <div class="cert-card-header">
                <div class="cert-card-title">${item.cert}</div>
                <button type="button" class="cert-card-remove" data-index="${index}">&times;</button>
              </div>
              <div class="cert-card-body">
                <div class="cert-thumbnail">
                  ${thumbnailHTML}
                </div>
                <div class="cert-file-info">
                  <div class="cert-file-name" title="${item.file.name}">${item.file.name}</div>
                  <div class="cert-file-size">${formatFileSize(item.file.size)}</div>
                </div>
              </div>
            `;

            // Add remove handler
            card
              .querySelector(".cert-card-remove")
              .addEventListener("click", () => {
                removeUploadedCertification(index);
              });

            uploadedCertsList.appendChild(card);
          });

          // Hide container if no certifications
          if (uploadedCertifications.length === 0 && uploadedCertsContainer) {
            uploadedCertsContainer.style.display = "none";
          }
        }

        // Remove uploaded certification
        function removeUploadedCertification(index) {
          uploadedCertifications.splice(index, 1);
          renderUploadedCertifications();
        }

        // Handle form submission
        if (subscribeForm) {
          const submitButton = subscribeForm.querySelector(
            ".form-submit-button",
          );

          subscribeForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const firstName = (
              document.getElementById("firstName")?.value || ""
            ).trim();
            const lastName = (
              document.getElementById("lastName")?.value || ""
            ).trim();
            const email = (
              document.getElementById("email")?.value || ""
            ).trim();
            const city = (
              document.getElementById("subscribeCity")?.value || ""
            ).trim();
            const state = (
              document.getElementById("subscribeState")?.value || ""
            ).trim();

            if (!email || !email.includes("@")) {
              alert("Please enter a valid email address.");
              return;
            }

            if (submitButton) {
              submitButton.disabled = true;
              submitButton.textContent = "Submitting...";
            }

            try {
              console.log("======================================");
              console.log("SUBSCRIBE FORM SUBMISSION STARTED");
              console.log("======================================");
              console.log("Form data:", { firstName, lastName, email, city, state });
              console.log("Uploaded certifications:", uploadedCertifications.length);
              uploadedCertifications.forEach((cert, i) => {
                console.log(`  Cert ${i}: ${cert.cert} - ${cert.file.name} (${cert.file.size} bytes)`);
              });

              // Create FormData to handle file uploads
              const formData = new FormData();
              formData.append("firstName", firstName);
              formData.append("lastName", lastName);
              formData.append("email", email);
              formData.append("city", city);
              formData.append("state", state);
              formData.append("sourceTag", "landing-modal");

              // Append certification files
              uploadedCertifications.forEach((item, index) => {
                formData.append("certifications", item.file);
                formData.append(`cert_type_${index}`, item.cert);
              });

              console.log("FormData prepared, sending to /api/subscribe...");

              const response = await fetch(
                "/api/subscribe",
                {
                  method: "POST",
                  // DON'T set Content-Type header - browser will set it automatically with boundary
                  body: formData,
                },
              );

              console.log("Response received:", response.status, response.statusText);

              const result = await response.json();
              console.log("Response body:", result);

              if (!response.ok || !result.success) {
                console.error("Subscription failed:", result.error);
                throw new Error(result.error || "Failed to subscribe");
              }

              console.log("Subscription successful!");
              console.log("======================================");

              subscribeForm.reset();
              uploadedCertifications.length = 0;
              renderUploadedCertifications();

              const filesUploaded = result.filesUploaded || 0;
              const message =
                filesUploaded > 0
                  ? `Thanks for subscribing! ${filesUploaded} certification(s) uploaded successfully.`
                  : "Thanks for subscribing! We will send updates soon.";

              alert(message);

              // Mark as subscribed in this session
              sessionStorage.setItem("hasSubscribed", "true");
              updateSubscribeButton();

              if (subscribeModal) {
                subscribeModal.classList.remove("active");
                document.body.style.overflow = "";
              }
            } catch (error) {
              console.error("======================================");
              console.error("SUBSCRIPTION ERROR:", error);
              console.error("Error name:", error.name);
              console.error("Error message:", error.message);
              console.error("Error stack:", error.stack);
              console.error("======================================");
              alert(
                error.message ||
                  "Unable to submit your subscription. Please try again.",
              );
            } finally {
              if (submitButton) {
                submitButton.disabled = false;
                submitButton.textContent = "Subscribe";
              }
            }
          });

          console.log("Subscribe form event listener attached");
        }

        // Load jobs
        fetchJobs(1);
        setupIntersectionObserver();

        console.log("Initialization complete");
        console.log("n");
      });
    </script>
  </body>
</html>